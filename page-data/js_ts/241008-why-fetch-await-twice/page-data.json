{"componentChunkName":"component---src-templates-blog-post-js","path":"/js_ts/241008-why-fetch-await-twice/","result":{"data":{"site":{"siteMetadata":{"title":"JuHeon's Dev Blog"}},"markdownRemark":{"id":"71da341c-6223-5988-b21d-16fdd9924386","excerpt":"함수 자바스크립트의 내장함수인 를 사용하여 데이터를 갖고 오기 위해서는 아래 코드와 같이 를 두번 사용해야 한다는 번거로움이 있다. 왜 굳이 이렇게 만들었을까 하는 의문이 생긴다. 처음부터 한 번의 로 데이터를 갖고오게끔 만들면 더 편리했을텐데 말이다. 그 이유는 HTTP…","html":"<h2><code class=\"language-text\">fetch</code> 함수</h2>\n<p>자바스크립트의 내장함수인 <code class=\"language-text\">fetch</code>를 사용하여 데이터를 갖고 오기 위해서는 아래 코드와 같이 <code class=\"language-text\">await</code>를 두번 사용해야 한다는 번거로움이 있다.</p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">const response = await fetch(&quot;/api&quot;)\nconst data = await response.json()</code>\n        </deckgo-highlight-code>\n<p>왜 굳이 이렇게 만들었을까 하는 의문이 생긴다. 처음부터 한 번의 <code class=\"language-text\">await</code>로 데이터를 갖고오게끔 만들면 더 편리했을텐데 말이다.</p>\n<p>그 이유는 HTTP 요청의 특성을 생각해보면 짐작할 수 있다. HTTP 요청은 header와 body 로 구성되어 있다. header 상에는 요청 메소드의 종류와 응답결과, 상태코드 등이 담겨 있다. 보통 header의 용량이 body의 용량보다 작을 것이므로 더 먼저 응답결과를 받아볼 수 있다는 점을 염두에 두고 아래 공식 문서를 살펴보자.</p>\n<p>mdn의 fetch <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API#concepts_and_usage\">공식문서</a>에서는 아래와 같이 설명하고 있다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR42j2OQY6DMBRDOUkj2MGCgfyEJB0aCAksuu39z/JGROosLEt+luxmHEecc9glsCwB7z3WWrTW+BCw7onzARFde3demfeISJUxhhACbdvS3CClxDMWXluhlEwpJ8eROPLJ9f6wpZOUds6S2bbIvu+s61o9xkjOmeu6GIaBpu97tAh6npimn/9332VnDUaEaZ7R5pdZPF3X8VCqPvrqzpRS/AG7yWFcqexqqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fetch-mdn\"\n        title=\"\"\n        src=\"/static/ee6613d688565dbef2bb20dd711adf2c/f058b/fetch-mdn.png\"\n        srcset=\"/static/ee6613d688565dbef2bb20dd711adf2c/c26ae/fetch-mdn.png 158w,\n/static/ee6613d688565dbef2bb20dd711adf2c/6bdcf/fetch-mdn.png 315w,\n/static/ee6613d688565dbef2bb20dd711adf2c/f058b/fetch-mdn.png 630w,\n/static/ee6613d688565dbef2bb20dd711adf2c/40601/fetch-mdn.png 945w,\n/static/ee6613d688565dbef2bb20dd711adf2c/78612/fetch-mdn.png 1260w,\n/static/ee6613d688565dbef2bb20dd711adf2c/64639/fetch-mdn.png 1568w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p><code class=\"language-text\">fetch()</code> 메소드는 당신이 fetch 하려는 리소스가 있는 경로라는 한 개의 필수적인 인자만 받는다. 그것은 해당 요청을 resolve 할 수 있는 <code class=\"language-text\">Response</code>객체를 내놓는 <code class=\"language-text\">Promise</code>를 반환한다 - <strong>서버가 header로 응답을 받자마자</strong> - 설령 서버의 응답이 error 상태라 하더라도.</p>\n</blockquote>\n<p>즉 <code class=\"language-text\">fetch()</code> 는 body는 신경쓰지 않고 일단 header만 도착하게 되면 응답할 수 있는 상태를 준비해준다는 것이다. 그리고 body안에 들어있는 데이터를 받기 위해서는 그때 비로소 <code class=\"language-text\">Response.json()</code>함수를 호출하면 된다는 뜻이다. 또한 만약에 header의 응답결과가 error 로 받았다면 우리는 body 를 아예 받지 않아도 되므로 네트워크 리소스를 절약할 수도 있다.</p>\n<p>이처럼 fetch 메소드는 데이터를 받는 단계를 두 단계로 나눠놓는 이유는 HTTP 요청의 특성을 생각해보면 납득할 수 있다.</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://tomontheinternet.com/why-two-awaits/\">https://tomontheinternet.com/why-two-awaits/</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API#concepts_and_usage\">https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API#concepts_and_usage</a></li>\n</ul>","frontmatter":{"title":"왜 fetch 함수는 await를 2번 해야 하는걸까?","date":"2024-10-07","description":null,"category":"JS/TS"}},"previous":{"fields":{"slug":"/essay/240805-2024-first-review/"},"frontmatter":{"title":"2024년 반기 회고"}},"next":{"fields":{"slug":"/html_css/241009-img-vs-background-image/"},"frontmatter":{"title":"<img>와 background-image 의 차이점"}}},"pageContext":{"id":"71da341c-6223-5988-b21d-16fdd9924386","previousPostId":"6cb51914-79d6-51a4-aaa9-2c0f1c7b78ac","nextPostId":"f58c0600-f741-56d7-b43a-3f73ce5dfa65"}},"staticQueryHashes":["2841359383","3821306223"],"slicesMap":{}}